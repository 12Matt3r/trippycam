<html lang="en">
<head>
<script async src="https://www.googletagmanager.com/gtag/js?id=G-0X4PB1JR3C"></script>
<script>
  window.dataLayer = window.dataLayer || [];
  function gtag(){dataLayer.push(arguments);}
  gtag('js', new Date());
  gtag('config', 'G-0X4PB1JR3C');
</script>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no">
    <title>TAKE A TRIP! Glitch Art & Datamosh in Real-time</title>
    <script src="https://cdn.jsdelivr.net/npm/qrcodejs@1.0.0/qrcode.min.js"></script>
    <link rel="stylesheet" href="styles.css">
</head>
<body>
    <canvas id="outputCanvas"></canvas>
    <video id="webcamVideo" playsinline autoplay muted></video>
    <div id="errorMessage"></div>
    <button id="floatingRandomizeButton">Randomize Effects</button>
    <div id="controls">
        <div id="controlsHeader">
            <span id="controlsTitle">TAKE A TRIP!</span>
            <div id="headerButtons">
                <button id="recordButton" class="record-button" title="Start Recording"></button>
                <button id="snapshotButton" class="record-button" title="Take Snapshot">
                    <svg viewBox="0 0 24 24" width="16" height="16" fill="currentColor"><path d="M9 2L7.17 4H4c-1.1 0-2 .9-2 2v12c0 1.1.9 2 2 2h16c1.1 0 2-.9 2-2V6c0-1.1-.9-2-2-2h-3.17L15 2H9zm3 15c-2.76 0-5-2.24-5-5s2.24-5 5-5 5 2.24 5 5-2.24 5-5 5z"/><circle cx="12" cy="12" r="3.5"/></svg>
                </button>
                <button id="refreshButton" class="record-button" title="Refresh Stream">
                    <svg viewBox="0 0 24 24" width="16" height="16" fill="currentColor"><path d="M17.65 6.35C16.2 4.9 14.21 4 12 4c-4.42 0-7.99 3.58-7.99 8s3.57 8 7.99 8c3.73 0 6.84-2.55 7.73-6h-2.08c-.82 2.33-3.04 4-5.65 4-3.31 0-6-2.69-6-6s2.69-6 6-6c1.66 0 3.14.69 4.22 1.78L13 11h7V4l-2.35 2.35z"/></svg>
                </button>
                <button id="switchCameraButton" class="record-button" title="Switch Camera">
                    <svg viewBox="0 0 24 24" width="16" height="16" fill="currentColor"><path d="M20 4h-3.17L15 2H9L7.17 4H4c-1.1 0-2 .9-2 2v12c0 1.1.9 2 2 2h16c1.1 0 2-.9 2-2V6c0-1.1-.9-2-2-2zm-5 11.5V13H9v2.5L5.5 12 9 8.5V11h6V8.5l3.5 3.5-3.5 3.5z"/></svg>
                </button>
                <button id="minimizeButton" title="Minimize Controls">
                    <svg viewBox="0 0 24 24"><path d="M19 13H5v-2h14v2z"/></svg>
                </button>
            </div>
        </div>
        <div id="controlsContent">
            <div class="tab-buttons">
                <button class="tab-button active" data-tab="main-tab">Main Controls</button>
                <button class="tab-button" data-tab="effects-tab">Effects</button>
                <button class="tab-button" data-tab="advanced-tab">Advanced</button>
            </div>
            
            <div id="main-tab" class="tab-content active">
                <div class="control-group">
                    <label for="presetSelector">Preset:</label>
                    <select id="presetSelector">
                        <option value="default">Default</option>
                        <option value="psychedelic">Psychedelic</option>
                        <option value="ghostly">Ghostly</option>
                        <option value="neon">Neon Traces</option>
                        <option value="glitchy">Glitchy VHS</option>
                        <option value="dreamy">Dreamy</option>
                    </select>
                </div>

                <div class="control-group"> <label for="trailRange">Trailing:</label> <input type="range" id="trailRange" min="0.0" max="1.5" step="0.005" value="0.9"> <input type="number" id="trailNumber" step="0.005" value="0.9"> </div>
                <div class="control-group"> <label for="motionRange">Motion:</label> <input type="range" id="motionRange" min="0.0" max="1.0" step="0.01" value="0.12"> <input type="number" id="motionNumber" step="0.01" value="0.12"> </div>
                <div class="control-group"> <label for="hueRange">Hue:</label> <input type="range" id="hueRange" min="-0.2" max="0.2" step="0.001" value="0.0"> <input type="number" id="hueNumber" step="0.001" value="0.0"> </div>
                
                <div class="button-group"> <button id="freezeButton" class="main-action-button">Freeze Frame (0)</button> <button id="clearFreezeButton" class="main-action-button" disabled>Clear Frozen</button> </div>
                <button id="randomizeButton" class="main-action-button" style="display: none; margin-top: 5px;">Randomize Sliders</button>
                
                <div class="control-group" style="margin-top: 10px;"> <label for="fileUploadInput" style="flex-basis: auto; margin-right: 5px; white-space: nowrap;">Upload:</label> <input type="file" id="fileUploadInput" accept="image/*,video/*"> </div>
                <button id="useWebcamButton" class="main-action-button" style="display: none; margin-top: 5px;">Use Webcam</button>
            </div>
            
            <div id="effects-tab" class="tab-content">
                <span id="currentEffectTitle" class="section-title" style="text-transform: capitalize; margin-bottom: 10px;">Effect Controls</span>
                <div class="control-group">
                    <label for="effectSelector">Effect:</label>
                    <select id="effectSelector">
                        <option value="datamosh">Datamosh</option>
                        <option value="pixelsort">Pixel Sort</option>
                        <option value="feedback">Feedback</option>
                        <option value="colorshift">Color Shift</option>
                        <option value="crt">CRT Effect</option>
                        <option value="mirror">Horizontal Mirror</option>
                        <option value="wavewarp">Wave Warp</option>
                        <option value="kaleidoscope">Kaleidoscope</option>
                        <option value="noiseGlitch">Noise Glitch</option>
                        <option value="fisheye">Fisheye Distortion</option>
                        <option value="feedbackDisplace">Feedback Displace</option>
                    </select>
                </div>
                
                <div class="control-group" data-control-key="intensity"> <label for="intensityRange">Intensity:</label> <input type="range" id="intensityRange" min="0.0" max="1.0" step="0.01" value="0.5"> <input type="number" id="intensityNumber" step="0.01" value="0.5"> </div>
                <div class="control-group" data-control-key="displacement"> <label for="displacementRange">Displace:</label> <input type="range" id="displacementRange" min="0.0" max="0.1" step="0.001" value="0.01"> <input type="number" id="displacementNumber" step="0.001" value="0.01"> </div>
                <div class="control-group" data-control-key="feedback"> <label for="feedbackRange">Feedback:</label> <input type="range" id="feedbackRange" min="0.0" max="0.95" step="0.01" value="0.2"> <input type="number" id="feedbackNumber" step="0.01" value="0.2"> </div>
                <div class="control-group" data-control-key="threshold"> <label for="thresholdRange">Threshold:</label> <input type="range" id="thresholdRange" min="0.0" max="1.0" step="0.01" value="0.5"> <input type="number" id="thresholdNumber" step="0.01" value="0.5"> </div>

                <!-- CRT Controls -->
                <div class="control-group" data-control-key="scanlineIntensity">
                    <label for="scanlineIntensityRange">Scanline Str:</label>
                    <input type="range" id="scanlineIntensityRange" min="0.0" max="1.0" step="0.01" value="0.3">
                    <input type="number" id="scanlineIntensityNumber" step="0.01" value="0.3">
                </div>
                <div class="control-group" data-control-key="scanlineDensity">
                    <label for="scanlineDensityRange">Scanline Den:</label>
                    <input type="range" id="scanlineDensityRange" min="100.0" max="1200.0" step="10" value="600.0">
                    <input type="number" id="scanlineDensityNumber" step="10" value="600.0">
                </div>
                <div class="control-group" data-control-key="curvatureAmount">
                    <label for="curvatureAmountRange">Curvature:</label>
                    <input type="range" id="curvatureAmountRange" min="0.0" max="0.5" step="0.005" value="0.1">
                    <input type="number" id="curvatureAmountNumber" step="0.005" value="0.1">
                </div>
                <div class="control-group" data-control-key="phosphorOffset">
                    <label for="phosphorOffsetRange">Phosphor:</label>
                    <input type="range" id="phosphorOffsetRange" min="0.0" max="0.02" step="0.0005" value="0.003">
                    <input type="number" id="phosphorOffsetNumber" step="0.0005" value="0.003">
                </div>
                <div class="control-group" data-control-key="vignetteStrength">
                    <label for="vignetteStrengthRange">Vignette Str:</label>
                    <input type="range" id="vignetteStrengthRange" min="0.0" max="1.0" step="0.01" value="0.2">
                    <input type="number" id="vignetteStrengthNumber" step="0.01" value="0.2">
                </div>
                <div class="control-group" data-control-key="vignetteSoftness">
                    <label for="vignetteSoftnessRange">Vignette Soft:</label>
                    <input type="range" id="vignetteSoftnessRange" min="0.0" max="2.0" step="0.01" value="0.5">
                    <input type="number" id="vignetteSoftnessNumber" step="0.01" value="0.5">
                </div>

                <!-- Wave Warp Controls -->
                <div class="control-group" data-control-key="waveDensity">
                    <label for="waveDensityRange">Wave Density:</label>
                    <input type="range" id="waveDensityRange" min="5.0" max="100.0" step="1" value="20.0">
                    <input type="number" id="waveDensityNumber" step="1" value="20.0">
                </div>
                <div class="control-group" data-control-key="waveSpeed">
                    <label for="waveSpeedRange">Wave Speed:</label>
                    <input type="range" id="waveSpeedRange" min="0.0" max="10.0" step="0.1" value="1.0">
                    <input type="number" id="waveSpeedNumber" step="0.1" value="1.0">
                </div>
                <div class="control-group" data-control-key="waveAmplitude">
                    <label for="waveAmplitudeRange">Wave Amplitude:</label>
                    <input type="range" id="waveAmplitudeRange" min="0.0" max="0.15" step="0.001" value="0.02">
                    <input type="number" id="waveAmplitudeNumber" step="0.001" value="0.02">
                </div>

                <!-- Kaleidoscope Controls -->
                <div class="control-group" data-control-key="kaleidoSegments">
                    <label for="kaleidoSegmentsRange">Kaleido Segs:</label>
                    <input type="range" id="kaleidoSegmentsRange" min="2" max="20" step="1" value="6">
                    <input type="number" id="kaleidoSegmentsNumber" min="2" max="20" step="1" value="6">
                </div>

                <!-- Fisheye Controls -->
                <div class="control-group" data-control-key="fisheyeStrength">
                    <label for="fisheyeStrengthRange">Fisheye Str:</label>
                    <input type="range" id="fisheyeStrengthRange" min="0.0" max="1.5" step="0.01" value="0.3">
                    <input type="number" id="fisheyeStrengthNumber" step="0.01" value="0.3">
                </div>

                <!-- Noise Glitch Controls -->
                <div class="control-group" data-control-key="glitchStrength">
                    <label for="glitchStrengthRange">Glitch Strength:</label>
                    <input type="range" id="glitchStrengthRange" min="0.0" max="1.0" step="0.01" value="0.1">
                    <input type="number" id="glitchStrengthNumber" step="0.01" value="0.1">
                </div>

                <!-- Fisheye Controls -->
                <div class="control-group" data-control-key="fisheyeStrength">
                    <label for="fisheyeStrengthRange">Fisheye Str:</label>
                    <input type="range" id="fisheyeStrengthRange" min="0.0" max="1.5" step="0.01" value="0.3">
                    <input type="number" id="fisheyeStrengthNumber" step="0.01" value="0.3">
                </div>
            </div>
            
            <div id="advanced-tab" class="tab-content">
                <div class="control-group"> <label for="historyRange">Buffer:</label> <input type="range" id="historyRange" min="1" max="16" step="1" value="6"> <input type="number" id="historyNumber" min="1" max="16" step="1" value="6"> </div>
                <div class="control-group"> <label for="extrapRange">Extrapolate:</label> <input type="range" id="extrapRange" min="0.0" max="2.0" step="0.01" value="0.0"> <input type="number" id="extrapNumber" step="0.01" value="0.0"> </div>
                <div class="control-group"> <label for="brightnessRange">Brightness:</label> <input type="range" id="brightnessRange" min="-0.5" max="0.5" step="0.01" value="0.0"> <input type="number" id="brightnessNumber" step="0.01" value="0.0"> </div>
                <div class="control-group"> <label for="contrastRange">Contrast:</label> <input type="range" id="contrastRange" min="0.5" max="2.0" step="0.01" value="1.0"> <input type="number" id="contrastNumber" step="0.01" value="1.0"> </div>
                <div class="control-group"> <label for="saturationRange">Saturation:</label> <input type="range" id="saturationRange" min="0.0" max="2.0" step="0.01" value="1.0"> <input type="number" id="saturationNumber" step="0.01" value="1.0"> </div>
                <div class="control-group" style="margin-top: 15px;">
                    <label for="audioReactiveCheckbox" style="flex-basis: auto; margin-right: 10px;">Enable Audio Reactivity (Mic):</label>
                    <input type="checkbox" id="audioReactiveCheckbox" style="width: 20px; height: 20px; flex-shrink: 0;">
                </div>
            </div>
        </div>
        <div id="resizeHandle"></div>
    </div>
</body>
    <script src="main.js"></script>
</html>
